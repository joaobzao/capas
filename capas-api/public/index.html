<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Capas ‚Äî Portugal</title>
  <meta name="description" content="Capas de jornais de Portugal agrupadas por sec√ß√µes." />
  <style>
    :root {
      --bg:#f9f9fb; --panel:#ffffff; --muted:#555; --text:#111; --accent:#3366ff; --chip:#f0f0f3;
      --card:#fff; --border:#ddd;
    }
    [data-theme="dark"] {
      --bg:#0b0c10; --panel:#111318; --muted:#8b95a7; --text:#e6eaf2; --accent:#4f7cff; --chip:#1a1f2b;
      --card:#0f1218; --border:#222833;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Helvetica,Arial}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    header h1{font-size:clamp(20px,3vw,28px);margin:0;font-weight:700;letter-spacing:.2px}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .search{display:flex;align-items:center;gap:8px;background:var(--panel);border:1px solid var(--border);padding:8px 10px;border-radius:10px;min-width:260px}
    .search input{all:unset;color:var(--text);width:220px}
    .btn{cursor:pointer;padding:6px 12px;border-radius:8px;background:var(--chip);border:1px solid var(--border);color:var(--text);font-size:13px}
    .badge{padding:6px 10px;background:var(--chip);border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:12px}
    .sections{display:flex;flex-direction:column;gap:28px}
    .section{display:flex;flex-direction:column;gap:12px}
    .section h2{font-size:18px;margin:0 4px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;transition:transform .15s ease, box-shadow .15s ease}
    .card:hover{transform:translateY(-2px)}
    .thumb{display:block;aspect-ratio:3/4;width:100%;background:#0a0d12;overflow:hidden;cursor:pointer}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .name{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .open{font-size:12px;color:var(--accent);text-decoration:none}
    .empty, .error, .loading{margin:24px 6px;color:var(--muted)}
    .footer{margin-top:26px;color:var(--muted);font-size:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .skeleton{background:linear-gradient(90deg,#eaeaea 0%,#f4f4f4 50%,#eaeaea 100%);background-size:200% 100%;animation:shimmer 1.2s infinite}
    [data-theme="dark"] .skeleton{background:linear-gradient(90deg,#0f1218 0%,#141923 50%,#0f1218 100%)}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .sk-card{height:260px;border-radius:14px}
    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:100;opacity:0;pointer-events:none;transition:opacity .2s}
    .modal.open{opacity:1;pointer-events:auto}
    .modal img{max-width:90%;max-height:90%;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,.6)}
    .modal button{position:absolute;top:20px;right:20px;padding:8px 12px;font-size:14px;cursor:pointer;border:none;border-radius:6px;background:#fff;color:#000}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Capas ‚Äî Portugal</h1>
      <div class="controls">
        <label class="search" aria-label="Pesquisar jornal">
          üîç <input id="q" type="search" placeholder="Pesquisar jornal..." />
        </label>
        <button id="themeToggle" class="btn">üåô Dark</button>
        <span id="status" class="badge">A carregar‚Ä¶</span>
      </div>
    </header>

    <div id="content" class="sections">
      <div class="grid" id="skeleton">
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
      </div>
    </div>

    <div class="footer" id="footer"></div>
  </div>

  <!-- Modal preview -->
  <div id="modal" class="modal">
    <img id="modalImg" src="" alt="Preview da capa" />
    <button id="modalClose">Fechar ‚úñ</button>
  </div>

  <script>
    const JSON_URL = "./capas.json";
    const SECTION_ORDER = ["Jornais Nacionais", "Desporto", "Economia e Gest√£o"];

    const elContent = document.getElementById("content");
    const elStatus  = document.getElementById("status");
    const elFooter  = document.getElementById("footer");
    const elSearch  = document.getElementById("q");

    const elModal   = document.getElementById("modal");
    const elModalImg= document.getElementById("modalImg");
    const elModalClose=document.getElementById("modalClose");

    let DATA = {}, FILTER = "";

    const byQuery = (name) => !FILTER || name.toLowerCase().includes(FILTER.toLowerCase());

    function render() {
      elContent.innerHTML = "";
      let total = 0;
      SECTION_ORDER.forEach((secName) => {
        const list = (DATA[secName] || []).filter(item => byQuery(item.nome));
        total += list.length;
        if (!list.length) return;

        const section = document.createElement("section");
        section.className = "section";
        section.innerHTML = `<h2>${secName}</h2>`;
        const grid = document.createElement("div");
        grid.className = "grid";

        list.forEach(item => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <div class="thumb" data-url="${item.url}">
              <img loading="lazy" src="${item.url}" alt="Capa ‚Äî ${item.nome}" />
            </div>
            <div class="meta">
              <div class="name" title="${item.nome}">${item.nome}</div>
              <a class="open" href="${item.url}" target="_blank" rel="noopener">abrir</a>
            </div>`;
          grid.appendChild(card);
        });

        section.appendChild(grid);
        elContent.appendChild(section);
      });
      if (total===0) {
        elContent.innerHTML = `<div class="empty">${FILTER?"Sem resultados":"Sem capas dispon√≠veis."}</div>`;
      }
      // bind modal open
      document.querySelectorAll(".thumb").forEach(el=>{
        el.addEventListener("click",()=>{
          elModalImg.src=el.dataset.url;
          elModal.classList.add("open");
        });
      });
    }

    async function load() {
      try {
        const res = await fetch(JSON_URL,{cache:"no-cache"});
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        DATA = await res.json();
        document.getElementById("skeleton")?.remove();
        render();
        elStatus.textContent="Pronto";
        elFooter.textContent=`Capas carregadas ‚Ä¢ Fonte: capas.json`;
      } catch(err){
        console.error(err);
        document.getElementById("skeleton")?.remove();
        elContent.innerHTML=`<div class="error">Erro ao carregar as capas.</div>`;
        elStatus.textContent="Erro";
      }
    }

    elSearch.addEventListener("input", e=>{FILTER=e.target.value;render();});
    elModalClose.addEventListener("click",()=>elModal.classList.remove("open"));
    elModal.addEventListener("click",e=>{if(e.target===elModal)elModal.classList.remove("open")});

    // theme toggle
    const themeBtn=document.getElementById("themeToggle");
    function setTheme(t){
      document.documentElement.setAttribute("data-theme",t);
      localStorage.setItem("theme",t);
      themeBtn.textContent=t==="dark"?"‚òÄÔ∏è Light":"üåô Dark";
    }
    themeBtn.addEventListener("click",()=>{
      const current=document.documentElement.getAttribute("data-theme")||"light";
      setTheme(current==="dark"?"light":"dark");
    });
    // init
    setTheme(localStorage.getItem("theme")||"light");
    load();
  </script>
</body>
</html>
