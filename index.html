<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Capas ‚Äî Portugal</title>
  <meta name="description" content="Capas de jornais de Portugal agrupadas por sec√ß√µes." />
  <style>
    :root{
      --bg:#0b0c10; --panel:#111318; --muted:#8b95a7; --text:#e6eaf2; --accent:#4f7cff; --chip:#1a1f2b;
      --card:#0f1218; --border:#222833;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    header h1{font-size:clamp(20px,3vw,28px);margin:0;font-weight:700;letter-spacing:.2px}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .search{display:flex;align-items:center;gap:8px;background:var(--panel);border:1px solid var(--border);padding:8px 10px;border-radius:10px;min-width:260px}
    .search input{all:unset;color:var(--text);width:220px}
    .badge{padding:6px 10px;background:var(--chip);border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:12px}
    .sections{display:flex;flex-direction:column;gap:28px}
    .section{display:flex;flex-direction:column;gap:12px}
    .section h2{font-size:18px;margin:0 4px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;transition:transform .15s ease, box-shadow .15s ease}
    .card:hover{transform:translateY(-2px)}
    .thumb{display:block;aspect-ratio:3/4;width:100%;background:#0a0d12;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .name{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .open{font-size:12px;color:var(--accent);text-decoration:none}
    .empty, .error, .loading{margin:24px 6px;color:var(--muted)}
    .footer{margin-top:26px;color:var(--muted);font-size:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .skeleton{background:linear-gradient(90deg,#0f1218 0%,#141923 50%,#0f1218 100%);background-size:200% 100%;animation:shimmer 1.2s infinite}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .sk-card{height:260px;border-radius:14px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Capas ‚Äî Portugal</h1>
      <div class="controls">
        <label class="search" aria-label="Pesquisar jornal">
          üîç <input id="q" type="search" placeholder="Pesquisar jornal..." />
        </label>
        <span id="status" class="badge">A carregar‚Ä¶</span>
      </div>
    </header>

    <div id="content" class="sections">
      <!-- Loading skeleton -->
      <div class="grid" id="skeleton">
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
        <div class="sk-card skeleton"></div>
      </div>
    </div>

    <div class="footer" id="footer"></div>
  </div>

  <script>
    // üëâ Se precisares, altera a URL do JSON aqui:
    const JSON_URL = "./capas.json"; // ou o URL completo do teu GitHub Pages

    // Ordem fixa das sec√ß√µes e labels a apresentar
    const SECTION_ORDER = ["Jornais Nacionais", "Desporto", "Economia e Gest√£o"];

    const elContent = document.getElementById("content");
    const elStatus  = document.getElementById("status");
    const elFooter  = document.getElementById("footer");
    const elSearch  = document.getElementById("q");

    let DATA = {}; // guardamos o JSON carregado
    let FILTER = ""; // texto da pesquisa

    const byQuery = (name) =>
      !FILTER || name.toLowerCase().includes(FILTER.toLowerCase());

    function render() {
      elContent.innerHTML = "";
      let total = 0;

      SECTION_ORDER.forEach((secName) => {
        const list = (DATA[secName] || []).filter(item => byQuery(item.nome));
        total += list.length;
        if (!list.length) return;

        const section = document.createElement("section");
        section.className = "section";
        section.innerHTML = `<h2>${secName}</h2>`;

        const grid = document.createElement("div");
        grid.className = "grid";

        list.forEach(item => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <a class="thumb" href="${item.url}" target="_blank" rel="noopener">
              <img loading="lazy" src="${item.url}" alt="Capa ‚Äî ${item.nome}" />
            </a>
            <div class="meta">
              <div class="name" title="${item.nome}">${item.nome}</div>
              <a class="open" href="${item.url}" target="_blank" rel="noopener">abrir</a>
            </div>`;
          grid.appendChild(card);
        });

        section.appendChild(grid);
        elContent.appendChild(section);
      });

      if (total === 0) {
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = FILTER
          ? "Sem resultados para a pesquisa."
          : "Sem capas dispon√≠veis.";
        elContent.appendChild(empty);
      }
    }

    async function load() {
      const t0 = performance.now();
      try {
        const res = await fetch(JSON_URL, { cache: "no-cache" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        DATA = await res.json();

        // esconder skeleton
        const sk = document.getElementById("skeleton");
        if (sk) sk.remove();

        render();

        // status + rodap√©
        const t1 = performance.now();
        const ms = Math.round(t1 - t0);
        elStatus.textContent = "Pronto";
        elFooter.textContent = `Capas carregadas em ${ms} ms ‚Ä¢ Fonte: capas.json`;
      } catch (err) {
        console.error(err);
        const sk = document.getElementById("skeleton");
        if (sk) sk.remove();

        const error = document.createElement("div");
        error.className = "error";
        error.textContent = "Erro ao carregar as capas. Tenta recarregar a p√°gina.";
        elContent.appendChild(error);
        elStatus.textContent = "Erro";
        elFooter.textContent = `Falha a obter ${JSON_URL}`;
      }
    }

    elSearch.addEventListener("input", (e) => {
      FILTER = e.target.value || "";
      render();
    });

    load();
  </script>
</body>
</html>
